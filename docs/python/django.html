
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Django Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../java/" />
    
    
    <link rel="prev" href="standard-library.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="./">
            
                <a href="./">
            
                    
                    Python
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="anaconda.html">
            
                <a href="anaconda.html">
            
                    
                    Anaconda
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="standard-library.html">
            
                <a href="standard-library.html">
            
                    
                    Python Stardard Library
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.3" data-path="django.html">
            
                <a href="django.html">
            
                    
                    Django
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../java/">
            
                <a href="../java/">
            
                    
                    Java
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../java/javafx.html">
            
                <a href="../java/javafx.html">
            
                    
                    JavaFX
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../java/android.md">
            
                <span>
            
                    
                    Android Studio
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../javascript/">
            
                <a href="../javascript/">
            
                    
                    JavaScript
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../javascript/jquery.html">
            
                <a href="../javascript/jquery.html">
            
                    
                    jQuery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../javascript/react.html">
            
                <a href="../javascript/react.html">
            
                    
                    React
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../javascript/react-native.html">
            
                <a href="../javascript/react-native.html">
            
                    
                    React Native
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../javascript/node-js.html">
            
                <a href="../javascript/node-js.html">
            
                    
                    Node.js
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../c-sharp/">
            
                <a href="../c-sharp/">
            
                    
                    C#
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../c-sharp/dot-net.html">
            
                <a href="../c-sharp/dot-net.html">
            
                    
                    .NET
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../c-sharp/asp-dot-net.html">
            
                <a href="../c-sharp/asp-dot-net.html">
            
                    
                    ASP.NET
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../c/">
            
                <a href="../c/">
            
                    
                    C
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../swift/">
            
                <a href="../swift/">
            
                    
                    Swift
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../swift/xcode.html">
            
                <a href="../swift/xcode.html">
            
                    
                    Xcode
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../markup/">
            
                <a href="../markup/">
            
                    
                    Markup Language
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../markup/html.html">
            
                <a href="../markup/html.html">
            
                    
                    HTML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../markup/xml.html">
            
                <a href="../markup/xml.html">
            
                    
                    XML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../markup/gfm.html">
            
                <a href="../markup/gfm.html">
            
                    
                    GFM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../markup/latex.html">
            
                <a href="../markup/latex.html">
            
                    
                    LaTeX
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../css/">
            
                <a href="../css/">
            
                    
                    CSS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../css/bootstrap.html">
            
                <a href="../css/bootstrap.html">
            
                    
                    Bootstrap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../typescript/">
            
                <a href="../typescript/">
            
                    
                    TypeScript
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../typescript/angular.html">
            
                <a href="../typescript/angular.html">
            
                    
                    Angular
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../php/">
            
                <a href="../php/">
            
                    
                    PHP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../cloud-services/">
            
                <a href="../cloud-services/">
            
                    
                    Cloud Services
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../cloud-services/aws.html">
            
                <a href="../cloud-services/aws.html">
            
                    
                    AWS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../cloud-services/google-cloud-platform.html">
            
                <a href="../cloud-services/google-cloud-platform.html">
            
                    
                    Google Cloud Platform
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../solution-stack/">
            
                <a href="../solution-stack/">
            
                    
                    Solution Stack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../sql/">
            
                <a href="../sql/">
            
                    
                    SQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../wechat-mini-program/">
            
                <a href="../wechat-mini-program/">
            
                    
                    Wechat Mini Program
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../cms/">
            
                <a href="../cms/">
            
                    
                    Content Management Systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="../cms/wordpress.html">
            
                <a href="../cms/wordpress.html">
            
                    
                    WordPress
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="../linux/">
            
                <a href="../linux/">
            
                    
                    Linux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" data-path="../linux/regex.html">
            
                <a href="../linux/regex.html">
            
                    
                    Regular Expression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2" data-path="../linux/bash-scripting.html">
            
                <a href="../linux/bash-scripting.html">
            
                    
                    Bash Scripting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="../virtualization/">
            
                <a href="../virtualization/">
            
                    
                    Virtualization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1" data-path="../virtualization/virtualbox.html">
            
                <a href="../virtualization/virtualbox.html">
            
                    
                    VirtualBox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.2" data-path="../virtualization/docker.html">
            
                <a href="../virtualization/docker.html">
            
                    
                    Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="../git/">
            
                <a href="../git/">
            
                    
                    Git
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="../graphic-design/">
            
                <a href="../graphic-design/">
            
                    
                    Graphic Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21" data-path="../networking/README.md">
            
                <span>
            
                    
                    Networking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22" data-path="../maple/">
            
                <a href="../maple/">
            
                    
                    Maple
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23" data-path="../theory/">
            
                <a href="../theory/">
            
                    
                    Theory
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.23.1" data-path="../theory/algorithm.html">
            
                <a href="../theory/algorithm.html">
            
                    
                    Data Structures and Algorithms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23.2" data-path="../theory/networking.html">
            
                <a href="../theory/networking.html">
            
                    
                    Networking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23.3" data-path="../theory/ml.html">
            
                <a href="../theory/ml.html">
            
                    
                    Machine Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23.4" data-path="../theory/cryptography.html">
            
                <a href="../theory/cryptography.html">
            
                    
                    Cryptography
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23.5" data-path="../theory/math.html">
            
                <a href="../theory/math.html">
            
                    
                    Mathematics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Django</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="django">Django</h1>
<h2 id="introduction">Introduction</h2>
<ul>
<li>Django is a Python-based free and open-source web framework</li>
<li>One Django project can have multiple Apps as web components.</li>
<li>Django uses WSGI to control the communication between the web server communicates and web applications, and how web applications can be chained together to process one request.<ul>
<li>WSGI is the Web Server Gateway Interface.</li>
</ul>
</li>
</ul>
<h2 id="useful-commands">Useful Commands</h2>
<ul>
<li><code>pip install django</code> install django library</li>
<li><code>python -m django --version</code> check the version</li>
<li><code>django-admin</code> show a list of sub-command</li>
<li><code>django-admin startproject &lt;project_name&gt;</code> create a new project.</li>
<li><code>python manage.py runserver</code> it will run the website and return the url of the running website. By default it is localhost:8000</li>
<li><code>python manage.py startapp &lt;appname&gt;</code> create a new app inside a project.</li>
<li><code>python manage.py makemigrations</code> update changes made on database model files for an app.<ul>
<li>create files in the <code>app/migrations</code> folder for the <code>migrate</code> command to run.</li>
<li>run <code>python manage.py sqlmigrate &lt;appname&gt; &lt;migrationID&gt;</code> to see the SQL code that will be run on the database when executing migrate command.<ul>
<li>Migration ID is the number in the file names in the <code>app/migration</code> folder.</li>
</ul>
</li>
</ul>
</li>
<li><code>python manage.py migrate</code><ul>
<li>first migration command will create default databases.</li>
<li><code>python manage.py migrate --fake &lt;appname&gt; &lt;migratationID&gt;</code> make certain migration, assume the database is the same as this migration file is made, reset the migration record. Migration Files after this time can be deleted.</li>
<li><code>python manage.py migrate --fake-initial</code> force making initial migrate with database is already exists.</li>
</ul>
</li>
<li><code>python manage.py showmigrations</code> Check migration history.</li>
<li><code>python manage.py createsuperuser</code> follow the promts and create admin account for the admin page.</li>
<li><code>python manage.py shell</code> It starts an interactive shell to run django project code line by line.</li>
<li><code>python manage.py collectstatic</code> it populates the static directory with static assets (JavaScript, CSS, and images).<ul>
<li>Make sure that <code>django.contrib.staticfiles</code> is included in the <code>INSTALLED_APPS</code> in <code>settings.py</code>.</li>
</ul>
</li>
</ul>
<h2 id="project-folder">Project Folder</h2>
<h3 id="settingspy">settings.py</h3>
<ul>
<li>To register an app to the project, add the element <code>&apos;appname.apps.AppNameConfig&apos;</code> or just <code>&apos;AppName&apos;</code> in the <code>INSTALLED_APPS</code> array.</li>
<li>Add <code>STATIC_ROOT = &apos;static&apos;</code> to tell Django where to store static files.</li>
<li>Add <code>USE_TZ = True</code> enable timezone support, then use <code>from django.utils import timezone</code>, <code>timezone.now()</code> to get current local time.</li>
<li>When <code>Debug=True</code>, static file will be auto generated.</li>
</ul>
<h3 id="urlspy">urls.py</h3>
<pre><code class="lang-py"><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
<span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path, include
<span class="hljs-keyword">from</span> users <span class="hljs-keyword">import</span> views <span class="hljs-keyword">as</span> user_views

urlpatterns = [
    path(<span class="hljs-string">&apos;admin/&apos;</span>, admin.site.urls),
    path(<span class="hljs-string">&apos;&apos;</span>, include(<span class="hljs-string">&apos;appnameA.urls&apos;</span>)),
    path(<span class="hljs-string">&apos;a/&apos;</span>, include(<span class="hljs-string">&apos;appnameB.urls&apos;</span>)),
    path(<span class="hljs-string">&apos;register/&apos;</span>, user_views.register, name=<span class="hljs-string">&apos;register&apos;</span>),
]
</code></pre>
<ul>
<li><code>urlpatterns</code> contains a list of path.</li>
<li>The first parameter of path is the url string, root path is empty.</li>
<li>A match is found when actual path begins with the string in the first parameter. Ex. <code>www.example.com/a/b/c</code> will matchs string <code>a/</code>.</li>
<li>When a match is found the <code>urls.py</code> file for the app <code>appnameA</code> will be loaded if the path is <code>www.example.com/</code></li>
<li>The path can also point to an app view file directly.</li>
</ul>
<h2 id="app-folder">App Folder</h2>
<h3 id="appspy">apps.py</h3>
<pre><code class="lang-py"><span class="hljs-keyword">from</span> django.apps <span class="hljs-keyword">import</span> AppConfig
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppNameConfig</span><span class="hljs-params">(AppConfig)</span>:</span>
    name = <span class="hljs-string">&apos;appname&apos;</span>
</code></pre>
<ul>
<li>The class name <code>AppNameConfig</code> should be registered in the project&apos;s <code>settings.py</code> file for the project to access the app.</li>
</ul>
<h3 id="urlspy">urls.py</h3>
<pre><code class="lang-py"><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path
<span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views
urlpatterns = [
    path(<span class="hljs-string">&apos;&apos;</span>, views.home, name=<span class="hljs-string">&apos;appname-home&apos;</span>),
    path(<span class="hljs-string">&apos;about/&apos;</span>, views.about, name=<span class="hljs-string">&apos;appname-about&apos;</span>),
]
</code></pre>
<ul>
<li>The full path excluded the matched string in the project <code>urls.py</code> will be used to match with the path strings here. For <code>www.example.com/a/b/c</code> after <code>a/</code> is matched in the project <code>urls.py</code>, <code>b/</code> will be used here to find a match.</li>
<li>the second parameter <code>views.home</code> is pointing to the <code>home</code> method in the <code>view.py</code> file.</li>
</ul>
<h3 id="viewpy">view.py</h3>
<pre><code class="lang-py"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render
<span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> HttpResponse
<span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> ModelClass
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home</span><span class="hljs-params">(request)</span>:</span>
    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&apos;&lt;h1&gt;Blog Home&lt;/h1&gt;&apos;</span>)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">about</span><span class="hljs-params">(request)</span>:</span>
    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&apos;&lt;h1&gt;Blog About&lt;/h1&gt;&apos;</span>)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home</span><span class="hljs-params">(request)</span>:</span>
    context = {
        <span class="hljs-string">&apos;posts&apos;</span>: ModelClass.objects.all()
    }
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;blog/home.html&apos;</span>, context)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">about</span><span class="hljs-params">(request)</span>:</span>
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;blog/about.html&apos;</span>, {<span class="hljs-string">&apos;title&apos;</span>: <span class="hljs-string">&apos;About&apos;</span>})
</code></pre>
<ul>
<li>Each method here is a page.</li>
<li>Each method has a parameter <code>request</code>.</li>
<li><code>HttpResponse</code> can be used to return html content in text for the webpage.</li>
<li>render method can be used to render a template page.<ul>
<li>The third parameter is the data that will be passed to the template page.</li>
<li>The data passed in like <code>post</code> can be a list of dictionary or just a dictionary of data.</li>
<li>The data passed in the example is from a data model.</li>
</ul>
</li>
</ul>
<h3 id="modelspy">models.py</h3>
<ul>
<li>This is the data model for the project.</li>
<li>Each class is corresponding to a database table.<pre><code class="lang-py"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.utils <span class="hljs-keyword">import</span> timezone
<span class="hljs-comment">#import user from built-in auth models</span>
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(models.Model)</span>:</span>
    <span class="hljs-comment"># exists by default, primary_key is mandatory.</span>
    id = models.AutoField(primary_key=<span class="hljs-keyword">True</span>)
    <span class="hljs-comment"># add nullable and allow it to be black options</span>
    title = models.CharField(max_length=<span class="hljs-number">100</span>,blank=<span class="hljs-keyword">True</span>, null=<span class="hljs-keyword">True</span>)
    <span class="hljs-comment"># add default value</span>
    content = models.TextField(default=<span class="hljs-string">&quot;Yes&quot;</span>)
    <span class="hljs-comment"># add unique option</span>
    date_posted = models.DateTimeField(default=timezone.now, unique=<span class="hljs-keyword">True</span>)
    <span class="hljs-comment"># set foreign key in the user table, delete all associated posts when user object is deleted.</span>
    author = models.ForeignKey(User, on_delete=models.CASCADE)
    <span class="hljs-comment"># Meta provides additional info for the Model</span>
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
      <span class="hljs-comment"># add check constrains</span>
      constraints = [
          models.CheckConstraint(check=models.Q(age__gte=<span class="hljs-number">18</span>), name=<span class="hljs-string">&apos;age_gte_18&apos;</span>),
      ]<span class="hljs-comment"># add index</span>
      index_together = [<span class="hljs-string">&quot;pub_date&quot;</span>, <span class="hljs-string">&quot;deadline&quot;</span>]
      indexes = [
          models.Index(fields=[<span class="hljs-string">&apos;last_name&apos;</span>, <span class="hljs-string">&apos;first_name&apos;</span>]),
          models.Index(fields=[<span class="hljs-string">&apos;first_name&apos;</span>], name=<span class="hljs-string">&apos;first_name_idx&apos;</span>),
      ]
      <span class="hljs-comment"># set name</span>
      db_table = <span class="hljs-string">&apos;music_album&apos;</span>
      <span class="hljs-comment"># set order when query</span>
      get_latest_by = <span class="hljs-string">&quot;order_date&quot;</span>
      ordering = [<span class="hljs-string">&apos;-pub_date&apos;</span>, <span class="hljs-string">&apos;author&apos;</span>]
</code></pre>
<ul>
<li><code>on.delete</code> has the following options:<ul>
<li><code>models.CASCADE</code> delete all associated records.</li>
<li><code>models.PROTECT</code> prevent deletion</li>
<li><code>models.SET_NULL</code></li>
<li><code>models.SET_DEFAULT</code> only default value it set.</li>
<li><code>models.SET(&apos;value&apos;)</code> set to certain value.</li>
</ul>
</li>
<li>When a class is defined as <code>abstract=True</code> in <code>Meta</code> options. Its fields can be reused by pass the Class Name in other class definition.<pre><code class="lang-py"><span class="hljs-comment"># The student table will have all fields from the CommonInfoAbstract class</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span><span class="hljs-params">(CommonInfoAbstract)</span>:</span>
  home_group = models.CharField(max_length=<span class="hljs-number">5</span>)
</code></pre>
</li>
<li>Model class can have a <code>__str__</code> method to define a string representation.<pre><code class="lang-py"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span><span class="hljs-params">(self)</span>:</span>
    <span class="hljs-keyword">return</span> self.title
</code></pre>
</li>
</ul>
</li>
<li>Whenever a file import the data model. It will have access to the data from the database.<pre><code class="lang-py"><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> ModelClass
ModelClass.objects.all() <span class="hljs-comment"># return all objects of this class from the database.</span>
ModelClass.objects.first() <span class="hljs-comment"># return the first object</span>
ModelClass.objects.last() <span class="hljs-comment"># return the last object</span>
ModelClass.objects.all()[<span class="hljs-number">0</span>:<span class="hljs-number">20</span>]<span class="hljs-comment"># return first 20 objects</span>
ModelClass.objects.filter(propertyname=<span class="hljs-string">&apos;value&apos;</span>) <span class="hljs-comment"># return a list of matching objects.</span>
ModelClass.objects.filter(propertyname=<span class="hljs-string">&apos;value&apos;</span>) <span class="hljs-comment"># return the first matching object.</span>
ModelClass.objects.get(id=<span class="hljs-number">1</span>) <span class="hljs-comment"># return the object with id 1</span>
newobject = ModelClass(property1=<span class="hljs-string">&apos;value1&apos;</span>, property2 = <span class="hljs-string">&apos;value2&apos;</span>) <span class="hljs-comment">#create a new object</span>
newobject.save() <span class="hljs-comment"># save change to the object that is already in the database</span>
modelObject.id <span class="hljs-comment"># get the object id</span>
modelObject.pk <span class="hljs-comment"># get the object primary key value</span>
modelObject.relatedModel_set.all() <span class="hljs-comment"># return all assciated model of one model.</span>
modelObject.relatedModel_set.create(property1=<span class="hljs-string">&apos;value1&apos;</span>, property2 = <span class="hljs-string">&apos;value2&apos;</span>) <span class="hljs-comment"># create a new related model of the model.</span>
</code></pre>
</li>
</ul>
<h3 id="adminpy">admin.py</h3>
<ul>
<li>It controls the admin page.</li>
<li>The default admin path is the site url followed by <code>/admin</code>.</li>
<li>Can be used to create users and groups.</li>
<li>All changes need to be made on the admin page not in the database directly. Otherwise, database tables need to be resync for the pointer values.<ul>
<li>For Postgre: run SQL <code>SELECT setval(&apos;your_table_id_seq&apos;, COALESCE((SELECT MAX(id) FROM your_table), 1), false);</code> in the database.<ul>
<li>run <code>SELECT nextval(&apos;your_table_id_seq&apos;);</code> to check the next value for insert.<ul>
<li>Everytime it runs, it will increase the <code>nextval</code> by one.</li>
</ul>
</li>
<li>run <code>SELECT MAX(id) FROM your_table;</code> to check the total record count.</li>
</ul>
</li>
</ul>
</li>
<li>Data models need to be registered here for the admin page to display and edit.<pre><code class="lang-py"><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
<span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Post
admin.site.register(Post)
</code></pre>
</li>
</ul>
<h3 id="static-folder">static folder</h3>
<ul>
<li>It can be used to store additional static files for the app, like css files.</li>
</ul>
<h3 id="template-folder">template folder</h3>
<ul>
<li>Apps can have template that stores dynamic html file that can access variables and run code inside.<ul>
<li>If support basic logic syntax in between html codes. Unlike Python code, each code block requried to be closed in the end.</li>
</ul>
</li>
<li>Variables here are passed from the <code>view.py</code>.<!--  --></li>
<li>To access <code>.css</code> files in the static folder, add <code>{% load static %}</code> at the first line and set css link url to <code>href=&quot;{% static &apos;appfolder/filename.css&apos; %}&quot;</code></li>
<li>All links in the template files are represented as <code>href=&quot;{% url &apos;path-name&apos; %}&quot;</code>. The pass name is the name attributes of the paths elements in the <code>urls.py</code>.</li>
<li>To display date in certain format use format string as <code>{{ post.date|date:&quot;F d, Y&quot; }}</code><!--  -->
</li>
</ul>
<h4 id="basehtml">base.html</h4>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    {% if title %}
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Django Blog - {{ title }}<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    {% else %}
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Django Blog<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    {% endif %}
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    {% block blockname %}{% endblock %}
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<ul>
<li>This is the layout that can be shared by all views.</li>
</ul>
<h4 id="contenthtml">content.html</h4>
<pre><code>{% extends &quot;appname/base.html&quot; %}
{% block blockname %}
    {% for post in posts %}
              &lt;h1&gt;{{ post.author }}&lt;/h1&gt;
              &lt;p&gt;{{ post.content }} posted on {{ post.date }}&lt;/p&gt;
    {% endfor %}
{% endblock blockname %}
</code></pre><ul>
<li>This is the file that will be inserted into the base template.</li>
<li>Templates from other apps can also be used here.</li>
<li>The block name should be the same name specified in the <code>base.html</code>.</li>
</ul>
<h3 id="customized-forms">Customized Forms</h3>
<ul>
<li>Create a <code>forms.py</code> in the app folder. Define a custom form class that inherit the default auth form from Django.<pre><code class="lang-py"><span class="hljs-keyword">from</span> django <span class="hljs-keyword">import</span> forms
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> django.contrib.auth.forms <span class="hljs-keyword">import</span> UserCreationForm
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserRegisterForm</span><span class="hljs-params">(UserCreationForm)</span>:</span>
    email = forms.EmailField()
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        model = User
        fields = [<span class="hljs-string">&apos;username&apos;</span>, <span class="hljs-string">&apos;email&apos;</span>, <span class="hljs-string">&apos;password1&apos;</span>, <span class="hljs-string">&apos;password2&apos;</span>]
        <span class="hljs-comment"># use this if all fields are included.</span>
        fields = <span class="hljs-string">&apos;__all__&apos;</span>
</code></pre>
</li>
<li>In the view page set up the request logic.<pre><code class="lang-py"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render, redirect
<span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> messages
<span class="hljs-keyword">from</span> .forms <span class="hljs-keyword">import</span> UserRegisterForm
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register</span><span class="hljs-params">(request)</span>:</span>
    <span class="hljs-comment"># If reveiving data</span>
    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&apos;POST&apos;</span>:
        form = UserRegisterForm(request.POST)
        <span class="hljs-keyword">if</span> form.is_valid():
            form.save()
            username = form.cleaned_data.get(<span class="hljs-string">&apos;username&apos;</span>)
            messages.success(request, f<span class="hljs-string">&apos;Account created for {username}!&apos;</span>)
            <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&apos;blog-home&apos;</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># if not receiving data initilize a new empty form</span>
        form = UserRegisterForm()
    <span class="hljs-comment"># render the form in the view</span>
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;users/register.html&apos;</span>, {<span class="hljs-string">&apos;form&apos;</span>: form})
</code></pre>
</li>
<li>run <code>pip install django-crispy-forms</code> to install the app that helps style the form with <code>Bootstrap</code>.</li>
<li>In <code>settings.py</code>, register the app as <code>&apos;crispy_forms&apos;</code> in <code>INSTALLED_APPS</code>, and <code>CRISPY_TEMPLATE_PACK = &apos;bootstrap4&apos;</code> at the bottom to specify the package in use.</li>
<li>For the form template:<!--  -->
<pre><code class="lang-py">{% extends &quot;blog/base.html&quot; %}
{% load crispy_forms_tags %}
{% block content %}
    &lt;div class=&quot;content-section&quot;&gt;
        &lt;form method=&quot;POST&quot;&gt;
            {% csrf_token %}
            &lt;fieldset&gt;
                &lt;legend&gt;Join Today&lt;/legend&gt;
                {{ form|crispy }}
            &lt;/fieldset&gt;
            &lt;div&gt;
                &lt;button type=&quot;submit&quot;&gt;Sign Up&lt;/button&gt;
            &lt;/div&gt;
        &lt;/form&gt;
    &lt;/div&gt;
{% endblock content %}
</code></pre>
<!-- {% raw %} --></li>
<li><p>Use this for feedback upon valid submission.</p>
<pre><code class="lang-py">

</code></pre>
</li>
</ul>
<h2 id="cloud-storages">Cloud Storages</h2>
<ul>
<li><a href="https://django-storages.readthedocs.io/en/latest/" target="_blank">Click</a> to see many possible cloud storage implementation for Django.</li>
</ul>
<h3 id="aws-s3">AWS S3</h3>
<ol>
<li>create a S3 bucket and set up permissions.</li>
<li>create a designated IAM user role for access.</li>
<li>Save credentials and buck name in the virtual environment&apos;s <code>.bash_profile</code> file.</li>
<li>run <code>pip install boto3</code> and <code>pip install django-storages</code></li>
<li>In <code>settings.py</code> add <code>&apos;storages&apos;</code> and following settings.<pre><code>AWS_ACCESS_KEY_ID = os.environ.get(&apos;AWS_ACCESS_KEY_ID&apos;)
AWS_SECRET_ACCESS_KEY = os.environ.get(&apos;AWS_SECRET_ACCESS_KEY&apos;)
AWS_STORAGE_BUCKET_NAME = os.environ.get(&apos;AWS_STORAGE_BUCKET_NAME&apos;)
AWS_S3_FILE_OVERWRITE = False
AWS_DEFAULT_ACL = None
DEFAULT_FILE_STORAGE = &apos;storages.backends.s3boto3.S3Boto3Storage&apos;
</code></pre></li>
</ol>
<h2 id="rest-framework">REST Framework</h2>
<ul>
<li>It is used to create restful api for the web app.</li>
<li><a href="https://www.django-rest-framework.org" target="_blank">Click here</a> for full docs.</li>
<li>run <code>pip install djangorestframework</code> to install</li>
<li>add <code>&apos;rest_framework&apos;</code> to <code>INSTALLED_APPS</code> in <code>settings.py</code></li>
<li>The Serializers convert objects into JSON data. It is defined in the <code>serializers.py</code> in the api app folder.<ul>
<li>Model Serializers - It provides a template that is easy to implement a serializer class based on model class.<pre><code class="lang-py"><span class="hljs-keyword">from</span> rest_framework <span class="hljs-keyword">import</span> serializers
<span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Sample
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SampleSerializer</span><span class="hljs-params">(serializers.ModelSerializer)</span>:</span>
<span class="hljs-comment"># add fielder from other serializers</span>
someFields = OtherSerializer(many=<span class="hljs-keyword">True</span>)
<span class="hljs-comment"># add fields in the meta class</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
    model = Sample
    <span class="hljs-comment"># add certain fields</span>
    fields = [<span class="hljs-string">&apos;id&apos;</span>, <span class="hljs-string">&apos;account_name&apos;</span>, <span class="hljs-string">&apos;users&apos;</span>, <span class="hljs-string">&apos;created&apos;</span>]
    <span class="hljs-comment"># exclude a certain field</span>
    exclude = [<span class="hljs-string">&apos;id&apos;</span>]
    <span class="hljs-comment"># add all fields</span>
    fields = <span class="hljs-string">&apos;__all__&apos;</span>
    <span class="hljs-comment"># add more options for previous fields.</span>
    extra_kwargs = {
            <span class="hljs-string">&apos;created&apos;</span>: {<span class="hljs-string">&apos;write_only&apos;</span>: <span class="hljs-keyword">True</span>},
            <span class="hljs-string">&apos;id&apos;</span>: {<span class="hljs-string">&apos;required&apos;</span>: <span class="hljs-keyword">True</span>}
    }
</code></pre>
</li>
<li>Serializers can be used to update or create JSON object by defining the <code>create()</code> and <code>update()</code> method in Serializer Class.<pre><code class="lang-py"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span><span class="hljs-params">(self, validated_data)</span>:</span>
    <span class="hljs-keyword">return</span> Sample.objects.create(**validated_data)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self, instance, validated_data)</span>:</span>
  instance.name = validated_data.get(<span class="hljs-string">&apos;name&apos;</span>, instance.name)
  instance.email = validated_data.get(<span class="hljs-string">&apos;email&apos;</span>, instance.email)
  instance.save()
  <span class="hljs-keyword">return</span> instance
</code></pre>
</li>
<li>Validation method can be added in the Serializer Class.<pre><code class="lang-py"><span class="hljs-comment"># field level validation</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate_title</span><span class="hljs-params">(self, value)</span>:</span>
    <span class="hljs-comment"># check if value contains keyword django</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">&apos;django&apos;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> value.lower():
        <span class="hljs-keyword">raise</span> serializers.ValidationError(<span class="hljs-string">&quot;Blog post is not about Django&quot;</span>)
    <span class="hljs-keyword">return</span> value
<span class="hljs-comment"># object level validation</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate</span><span class="hljs-params">(self, data)</span>:</span>
    <span class="hljs-keyword">if</span> data[<span class="hljs-string">&apos;start&apos;</span>] &gt; data[<span class="hljs-string">&apos;finish&apos;</span>]:
        <span class="hljs-keyword">raise</span> serializers.ValidationError(<span class="hljs-string">&quot;finish must occur after start&quot;</span>)
    <span class="hljs-keyword">return</span> data
</code></pre>
</li>
</ul>
</li>
<li>In <code>views.py</code> defines the behavior of the certain path, when either a POST(update) request or GET(read) request is sent.<pre><code class="lang-py"><span class="hljs-keyword">from</span> rest_framework <span class="hljs-keyword">import</span> status <span class="hljs-comment"># return status</span>
<span class="hljs-comment"># enable .as_view in urls.py that return a view based on JSON result</span>
<span class="hljs-keyword">from</span> rest_framework.views <span class="hljs-keyword">import</span> APIView
<span class="hljs-comment"># Response to return for each view method</span>
<span class="hljs-keyword">from</span> rest_framework.response <span class="hljs-keyword">import</span> Response
<span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Sample
<span class="hljs-keyword">from</span> .serializers <span class="hljs-keyword">import</span> SampleSerializer
<span class="hljs-comment"># inherite methods from APIView class</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SampleView</span><span class="hljs-params">(APIView)</span>:</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span><span class="hljs-params">(self, request)</span>:</span>
    <span class="hljs-comment"># get all current data</span>
    data = Sample.objects.all()
    <span class="hljs-comment"># initalize a serializer take multiple data object into JSON.</span>
    <span class="hljs-comment"># many = True enables convertion of multiple objects</span>
    serializer = SampleSerializer(data, many = <span class="hljs-keyword">True</span>)
    <span class="hljs-comment"># return the JSON data in response</span>
    <span class="hljs-keyword">return</span> Response(serializer.data)
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post</span><span class="hljs-params">(self)</span>:</span>
    <span class="hljs-comment"># if pass here means this method does nothing.</span>
    <span class="hljs-keyword">pass</span>
    <span class="hljs-comment"># if serializer has create method.</span>
    data = Snippet(code=<span class="hljs-string">&apos;foo = &quot;bar&quot;\n&apos;</span>)
</code></pre>
<ul>
<li>When serializer has <code>create()</code> or <code>update()</code> methods. <code>serializer.save(data=data)</code> method will run <code>create()</code>. <code>serializer.save(existingObject, data=data)</code> will run <code>update()</code>.</li>
<li>When serializer has <code>validate()</code>, <code>serializer.is_valid()</code> will run validation. Then use <code>serializer.error()</code> to return errors.</li>
</ul>
</li>
<li>In <code>urls.py</code> add the view method that returning data as view to path, <code>path(&apos;api/&apos;, views.SampleView.as_view()),</code></li>
<li>Pagination<ul>
<li>Set Pagination globally in <code>settings.py</code><ul>
<li>For Pagination based on page number<pre><code class="lang-js">REST_FRAMEWORK = {
  DEFAULT_PAGINATION_CLASS:
    <span class="hljs-string">&quot;rest_framework.pagination.PageNumberPagination&quot;</span>,
  PAGE_SIZE: <span class="hljs-number">100</span>,
};
</code></pre>
</li>
<li>For cursor pagination<pre><code class="lang-js">REST_FRAMEWORK = {
  DEFAULT_PAGINATION_CLASS: <span class="hljs-string">&quot;rest_framework.pagination.CursorPagination&quot;</span>,
  PAGE_SIZE: <span class="hljs-number">100</span>,
};
</code></pre>
</li>
<li>For Limit Offset Pagination<pre><code class="lang-js">REST_FRAMEWORK = {
  DEFAULT_PAGINATION_CLASS:
    <span class="hljs-string">&quot;rest_framework.pagination.LimitOffsetPagination&quot;</span>,
};
</code></pre>
</li>
</ul>
</li>
<li>Set Pagination for each method of <code>views.py</code> individually<ul>
<li>defind the pagination class<pre><code class="lang-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StandardResultsSetPagination</span><span class="hljs-params">(PageNumberPagination)</span>:</span>
page_size = <span class="hljs-number">100</span>
page_size_query_param = <span class="hljs-string">&apos;page_size&apos;</span>
max_page_size = <span class="hljs-number">1000</span>
</code></pre>
</li>
<li>Assign the class name to the <code>pagination_class</code> variables in the each view method.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="swagger">Swagger</h3>
<ul>
<li>It auto generate document pages for the Rest API</li>
</ul>
<h5 id="usage">Usage</h5>
<ol>
<li>Run <code>pip install django-rest-swagger</code></li>
<li>Add <code>&apos;rest_framework_swagger&apos;</code> to <code>INSTALLED_APPS</code> in Django settings.</li>
<li>In API app&apos;s <code>views.py</code> add<pre><code class="lang-py"><span class="hljs-keyword">from</span> rest_framework_swagger.views <span class="hljs-keyword">import</span> get_swagger_view
schema_view = get_swagger_view(title=<span class="hljs-string">&apos;Pastebin API&apos;</span>)
</code></pre>
<ul>
<li>There are two optional parameter for the <code>get_swagger_view()</code> method:<ul>
<li><code>title</code>: The title of the documentation <code>(Default: None)</code></li>
<li><code>url</code>: The URL to the documentation, if not on the same host or path. Can be a relative path or can be an absolute URL. <code>(Default: None)</code></li>
</ul>
</li>
</ul>
</li>
<li>add path in <code>urls.py</code><pre><code class="lang-py"><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> url
urlpatterns = [
    url(<span class="hljs-string">r&apos;^$&apos;</span>, appname.views.docs_view)
]
</code></pre>
</li>
<li>Make additional setting in the <code>settings.py</code> file.<pre><code class="lang-py">SWAGGER_SETTINGS = {
  <span class="hljs-string">&apos;SHOW_REQUEST_HEADERS&apos;</span>: <span class="hljs-keyword">True</span>,
  <span class="hljs-string">&apos;SUPPORTED_SUBMIT_METHODS&apos;</span>: [
      <span class="hljs-string">&apos;get&apos;</span>,
      <span class="hljs-string">&apos;post&apos;</span>,
  ]
}
</code></pre>
<ul>
<li><a href="https://django-rest-swagger.readthedocs.io/en/latest/settings/" target="_blank">Click Here</a> to see all setting options.</li>
</ul>
</li>
<li><p>Add docs string comments to provide more info in the docs page.</p>
</li>
<li><p>If see <code>&apos;AutoSchema&apos; object has no attribute &apos;get_link&apos; swagger</code> error, add <code>&apos;DEFAULT_SCHEMA_CLASS&apos;: &apos;rest_framework.schemas.coreapi.AutoSchema&apos;,</code> in the <code>settings.py</code>.</p>
</li>
</ol>
<h3 id="geodjango">GeoDjango</h3>
<ul>
<li>It provide data model and function for GIS supported database.<ul>
<li><code>PostgreSQL</code> uses <code>PostGIS</code> extenstion.</li>
</ul>
</li>
<li>It is included in the Django package.</li>
<li><code>QGIS</code> is a GIS app that helps install all the required database drivers.<ul>
<li><code>PostgreSQL</code> requires <code>GDAL</code>, <code>GEOS</code>, and <code>PROJ.4</code>.</li>
</ul>
</li>
</ul>
<h4 id="setup">Setup</h4>
<ul>
<li>Install drivers<ul>
<li><code>PostgreSQL</code> requires <code>GDAL</code>, <code>GEOS</code>, and <code>PROJ.4</code>.<ul>
<li>For Mac:<ul>
<li>run <code>brew install gdal</code></li>
<li>run <code>brew install geos</code></li>
<li>run <code>brew install proj</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Install PostGIS extension<ul>
<li>If installing locally, click the PostGIS extension in the slack builder wizards.</li>
<li>If using AWS RDS, skip this step and enable the exstension directly.</li>
</ul>
</li>
<li>Add extension to the database, in PGAdmin select the database, right click extension, then add.<ul>
<li>or run SQL <code>CREATE EXTENSION postgis</code>.</li>
</ul>
</li>
<li>Download and Install QGIS from its <a href="https://qgis.org/en/site/forusers/download.html" target="_blank">official website</a></li>
<li>Set database engine in <code>setting.py</code>.<ul>
<li>Use <code>django.contrib.gis.db.backends.postgis</code> for <code>PostgreSQL</code>.</li>
</ul>
</li>
<li>Add <code>django.contrib.gis</code> to <code>INSTALLED_APPS</code> in <code>setting.py</code></li>
</ul>
<h2 id="django-crontab">Django Crontab</h2>
<ul>
<li>It manages crontab tasks with django.</li>
<li>Usage:<ol>
<li>run <code>pip install django-crontab</code> to install</li>
<li>add <code>&apos;django_crontab&apos;</code> to the <code>INSTALLED_APPS</code> in the <code>settings.py</code>.</li>
<li>create a python file in the project or app foloder and define task methods.</li>
<li>add the methods in the <code>settings.py</code> using the following format.<pre><code class="lang-py">CRONJOBS = [
(<span class="hljs-string">&apos;*/5 * * * *&apos;</span>, <span class="hljs-string">&apos;myapp.cron.my_scheduled_job&apos;</span>),
(<span class="hljs-string">&apos;0   0 1 * *&apos;</span>, <span class="hljs-string">&apos;myapp.cron.my_scheduled_job&apos;</span>, <span class="hljs-string">&apos;&gt;&gt; /tmp/scheduled_job.log&apos;</span>),
(<span class="hljs-string">&apos;*/5 * * * *&apos;</span>, <span class="hljs-string">&apos;myapp.cron.other_scheduled_job&apos;</span>, [<span class="hljs-string">&apos;arg1&apos;</span>, <span class="hljs-string">&apos;arg2&apos;</span>], {<span class="hljs-string">&apos;verbose&apos;</span>: <span class="hljs-number">0</span>}),
(<span class="hljs-string">&apos;0   4 * * *&apos;</span>, <span class="hljs-string">&apos;django.core.management.call_command&apos;</span>, [<span class="hljs-string">&apos;clearsessions&apos;</span>]),
]
</code></pre>
<ul>
<li>optionally the task can take a list of positional arguments for the method (default: [])</li>
<li>optionally the task can take a dictionary of keyword arguments for the method (default: {})</li>
</ul>
</li>
<li>add or update new tasks added in the <code>settings.py</code> by running command <code>python manage.py crontab add</code><ul>
<li>run <code>python manage.py crontab show</code> to show the list of tasks.</li>
<li>run <code>python manage.py crontab remove</code> to remove all registered tasks.</li>
</ul>
</li>
</ol>
</li>
</ul>
<h2 id="celery">Celery</h2>
<h3 id="introduction">Introduction</h3>
<ul>
<li>It&#x2019;s a task queue with focus on real-time processing, while also supporting task scheduling.</li>
<li>It is not included in the anaconda default package, and need to be installed using command <code>conda install celery</code>.</li>
</ul>
<h3 id="basic-usage">Basic Usage</h3>
<ol>
<li>Celery requires a broker to store task list in a queue. There are three options, follow one of the link to install:<ul>
<li>RabbitMQ(fully supported recommanded) - <a href="http://docs.celeryproject.org/en/latest/getting-started/brokers/rabbitmq.html#broker-rabbitmq" target="_blank">click</a> to see installation &amp; configuration instruction.<ul>
<li>Not need to pip install rabbitMQ for project</li>
<li>Install server <code>brew install rabbitmq</code></li>
<li>Add environment variables <code>PATH=$PATH:/usr/local/sbin</code> in <code>.bash_profile</code></li>
<li>run the server <code>sudo rabbitmq-server</code> use <code>-detached</code> to run in background.</li>
<li>commplete the following config in command lines.<pre><code class="lang-bash">$ sudo rabbitmqctl add_user myuser mypassword
$ sudo rabbitmqctl add_vhost myvhost
$ sudo rabbitmqctl <span class="hljs-built_in">set</span>_user_tags myuser mytag
$ sudo rabbitmqctl <span class="hljs-built_in">set</span>_permissions -p myvhost myuser <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span>
</code></pre>
</li>
<li>Add the connection string <code>broker_url = &apos;amqp://myuser:mypassword@localhost:5672/myvhost&apos;</code>, and <code>CELERY_AUTH_MECHANISMS = [&apos;PLAIN&apos;, &apos;AMQPLAIN&apos;]</code> to set allowed AUTH MECHANISMS</li>
<li>run <code>sudo rabbitmqctl status</code> to check status.</li>
<li>if want to stop the server run <code>sudo rabbitmqctl stop</code>.</li>
</ul>
</li>
<li>Redis - <a href="http://docs.celeryproject.org/en/latest/getting-started/brokers/redis.html#broker-redis" target="_blank">click</a> to see installation &amp; configuration instruction.<ul>
<li>run <code>pip install -U &quot;celery[redis]&quot;</code> to install Celery and Redis as a bundle.</li>
<li>For Django app add <code>BROKER_URL = &apos;redis://localhost:6379/0&apos;</code> and <code>BROKER_TRANSFER = &apos;redis&apos;</code> in <code>settings.py</code>.</li>
<li>install server locally <code>brew install redis</code> and run it <code>redis-server</code>.</li>
<li>test server <code>redis-cli ping</code></li>
</ul>
</li>
<li>Amazon SQS - <a href="http://docs.celeryproject.org/en/latest/getting-started/brokers/sqs.html#broker-sqs" target="_blank">click</a> to see installation &amp; configuration instruction.</li>
</ul>
</li>
<li>Defines the task in <code>tasks.py</code><pre><code class="lang-py"><span class="hljs-keyword">from</span> celery <span class="hljs-keyword">import</span> Celery
app = Celery(<span class="hljs-string">&apos;tasks&apos;</span>, broker=<span class="hljs-string">&apos;pyamqp://guest@localhost//&apos;</span>)
<span class="hljs-meta">@app.task</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(x, y)</span>:</span>
  <span class="hljs-keyword">return</span> x + y
</code></pre>
</li>
<li>Run the Celery server by running command <code>celery -A &lt;projectName&gt; worker --loglevel=info</code>.</li>
<li>Call the task<pre><code class="lang-py"><span class="hljs-keyword">from</span> tasks <span class="hljs-keyword">import</span> add
<span class="hljs-meta">&gt;&gt;&gt; </span>add.delay(<span class="hljs-number">4</span>, <span class="hljs-number">4</span>)
</code></pre>
</li>
<li>Setup and view the result<ol>
<li>add the <code>backend</code> argument to Celery, using a selected backend storage method from <a href="http://docs.celeryproject.org/en/latest/getting-started/first-steps-with-celery.html#keeping-results" target="_blank">here</a></li>
<li>Access result using the following ways<pre><code class="lang-py">result = add.delay(<span class="hljs-number">4</span>, <span class="hljs-number">4</span>)
result.ready() <span class="hljs-comment">#return true if it is done.</span>
result.get(timeout=<span class="hljs-number">1</span>) <span class="hljs-comment"># get result after a certain duration.</span>
result.get(propagate=<span class="hljs-keyword">False</span>) <span class="hljs-comment"># preventing a exception is reraised when calling get() after an error.</span>
result.traceback <span class="hljs-comment">#  access to the original traceback after a exception is raised.</span>
<span class="hljs-comment"># Remember to call either get() or forget() to release the memory</span>
result.forget()
</code></pre>
</li>
</ol>
</li>
<li>Do additional settings<ul>
<li>To change a certain settings <code>app.conf.task_serializer = &apos;json&apos;</code></li>
<li>To change multiple settings:<pre><code class="lang-py">app.conf.update(
task_serializer=<span class="hljs-string">&apos;json&apos;</span>,
accept_content=[<span class="hljs-string">&apos;json&apos;</span>],  <span class="hljs-comment"># Ignore other content</span>
result_serializer=<span class="hljs-string">&apos;json&apos;</span>,
timezone=<span class="hljs-string">&apos;Europe/Oslo&apos;</span>,
enable_utc=<span class="hljs-keyword">True</span>,
)
</code></pre>
</li>
<li>To change settings from a config file, use <code>app.config_from_object(&apos;celeryconfig&apos;)</code>, An example config file named <code>celeryconfig.py</code> is shown as follows:<pre><code class="lang-py">broker_url = <span class="hljs-string">&apos;pyamqp://&apos;</span>
result_backend = <span class="hljs-string">&apos;rpc://&apos;</span>
task_serializer = <span class="hljs-string">&apos;json&apos;</span>
result_serializer = <span class="hljs-string">&apos;json&apos;</span>
accept_content = [<span class="hljs-string">&apos;json&apos;</span>]
timezone = <span class="hljs-string">&apos;Europe/Oslo&apos;</span>
enable_utc = <span class="hljs-keyword">True</span>
</code></pre>
</li>
</ul>
</li>
</ol>
<h3 id="work-with-django">Work with Django</h3>
<ol>
<li>Add the Celery instance definition at <code>proj/proj/celery.py</code><pre><code class="lang-py"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> absolute_import, unicode_literals
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> celery <span class="hljs-keyword">import</span> Celery
<span class="hljs-comment"># set the default Django settings module for the &apos;celery&apos; program.</span>
os.environ.setdefault(<span class="hljs-string">&apos;DJANGO_SETTINGS_MODULE&apos;</span>, <span class="hljs-string">&apos;proj.settings&apos;</span>)
app = Celery(<span class="hljs-string">&apos;proj&apos;</span>)
<span class="hljs-comment"># Using a string here means the worker doesn&apos;t have to serialize</span>
<span class="hljs-comment"># the configuration object to child processes.</span>
<span class="hljs-comment"># - namespace=&apos;CELERY&apos; means all celery-related configuration keys</span>
<span class="hljs-comment">#   should have a `CELERY_` prefix.</span>
app.config_from_object(<span class="hljs-string">&apos;django.conf:settings&apos;</span>, namespace=<span class="hljs-string">&apos;CELERY&apos;</span>)
<span class="hljs-comment"># Load task modules from all registered Django app configs.</span>
app.autodiscover_tasks()
<span class="hljs-meta">@app.task(bind=True)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug_task</span><span class="hljs-params">(self)</span>:</span>
    print(<span class="hljs-string">&apos;Request: {0!r}&apos;</span>.format(self.request))
</code></pre>
</li>
<li>Let celery start in the <code>proj/proj/__init__.py</code> when django starts.<pre><code class="lang-py"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> absolute_import, unicode_literals
<span class="hljs-comment"># This will make sure the app is always imported when</span>
<span class="hljs-comment"># Django starts so that shared_task will use this app.</span>
<span class="hljs-keyword">from</span> .celery <span class="hljs-keyword">import</span> app <span class="hljs-keyword">as</span> celery_app
__all__ = (<span class="hljs-string">&apos;celery_app&apos;</span>,)
</code></pre>
</li>
<li>Write tasks in the <code>tasks.py</code> in app folders<pre><code class="lang-py"><span class="hljs-comment"># Create your tasks here</span>
<span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> absolute_import, unicode_literals
<span class="hljs-keyword">from</span> celery <span class="hljs-keyword">import</span> shared_task
<span class="hljs-keyword">from</span> demoapp.models <span class="hljs-keyword">import</span> Widget
<span class="hljs-meta">@shared_task</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(x, y)</span>:</span>
    <span class="hljs-keyword">return</span> x + y
<span class="hljs-meta">@shared_task</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mul</span><span class="hljs-params">(x, y)</span>:</span>
    <span class="hljs-keyword">return</span> x * y
<span class="hljs-meta">@shared_task</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">xsum</span><span class="hljs-params">(numbers)</span>:</span>
    <span class="hljs-keyword">return</span> sum(numbers)
<span class="hljs-meta">@shared_task</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">count_widgets</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">return</span> Widget.objects.count()
<span class="hljs-meta">@shared_task</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rename_widget</span><span class="hljs-params">(widget_id, name)</span>:</span>
    w = Widget.objects.get(id=widget_id)
    w.name = name
    w.save()
</code></pre>
</li>
</ol>
<h3 id="celery-beat">Celery Beat</h3>
<ul>
<li>This is a celery extension that stores the schedule in the Django database, and presents a convenient admin interface to manage periodic tasks at runtime.</li>
<li>Setup steps:<ol>
<li>Use pip to install the package, <code>pip install django-celery-beat</code></li>
<li>Add the <code>django_celery_beat</code> module to <code>INSTALLED_APPS</code> in <code>settings.py</code></li>
<li>Apply Django database migrations so that the necessary tables are created: <code>python manage.py migrate</code></li>
<li>Start the celery beat service <code>celery -A proj beat -l info --scheduler django_celery_beat.schedulers:DatabaseScheduler</code></li>
<li>add the related settings if nesscery, <a href="http://docs.celeryproject.org/en/latest/userguide/configuration.html#beat-settings-celery-beat" target="_blank">click</a> to see more details.</li>
<li>Visit the Django-Admin interface to set up some periodic tasks.</li>
</ol>
</li>
</ul>
<h3 id="daemonization">Daemonization</h3>
<ul>
<li>In production you&#x2019;ll want to run the worker in the background as a daemon instead of running the service using commands explicitly.</li>
<li>Either <code>systemd</code> or <code>supervisord</code> can be used.</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="standard-library.html" class="navigation navigation-prev " aria-label="Previous page: Python Stardard Library">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../java/" class="navigation navigation-next " aria-label="Next page: Java">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Django","level":"1.2.3","depth":2,"next":{"title":"Java","level":"1.3","depth":1,"path":"java/README.md","ref":"java/README.md","articles":[{"title":"JavaFX","level":"1.3.1","depth":2,"path":"java/javafx.md","ref":"java/javafx.md","articles":[]},{"title":"Android Studio","level":"1.3.2","depth":2,"path":"java/android.md","ref":"java/android.md","articles":[]}]},"previous":{"title":"Python Stardard Library","level":"1.2.2","depth":2,"path":"python/standard-library.md","ref":"python/standard-library.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"python/django.md","mtime":"2020-04-29T20:46:34.541Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-05-09T22:28:15.640Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

